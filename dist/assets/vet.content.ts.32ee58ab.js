import{S as L}from"./comparison.utils.08c82949.js";import{l as O,f as E,k as P,m as N,a as $,I as M,c as D,p as j,d as x,b as F,e as R}from"./content.utils.1be2cea8.js";import{d as W,c as B}from"./formatters.738ad4ac.js";import{s as Q}from"./init.content.8bae4b55.js";const H=(o,s="asc")=>o.sort((t,l)=>{const a=t[0].startTime,r=t[t.length-1].endTime,n=l[0].startTime,e=l[l.length-1].endTime;if(a!==n)return a-n;const i=r-a,c=e-n;return s==="asc"?i-c:c-i}),J=(o,s="asc")=>o.sort((t,l)=>{const a=t[0].startTime;let r=t[t.length-1].endTime;r<=a&&(r=r+24*60);const n=l[0].startTime;let e=l[l.length-1].endTime;e<=n&&(e=e+24*60);const i=r-a,c=e-n;return s==="asc"?i-c:c-i}),K=(o,s="asc",t)=>{const l=o.map(e=>[e]),a=H(l,s),r=[];for(let e=0;e<a.length;e++){const i=[...a[e]];if(i[i.length-1].endTime>=24*60)break;let c=e+1,f=a.length-1;for(;f>0&&!(i[i.length-1].endTime>=24*60);){f--,c===a.length&&(c=0);const m=[...a[c]];let d=i[i.length-1].endTime,u=m[0].startTime;u>=24*60&&(u=u-24*60),d>=24*60&&(d=d-24*60);const g=u-d;t(g)&&i.push(...m),c++}i.length>1&&r.push(i)}return r.push(...l),J(r,s)},V=(o,s,{isTestMode:t})=>{if(!document.querySelector('div[role="presentation"]'))return[];const a=[];return s.querySelectorAll('div[role="listitem"]').forEach(n=>{const e=n.querySelector('div[role="heading"]');if(e){let i=n.querySelector('button[data-test-id="AddOpportunityModalButton"]');if(t&&(i=n.querySelector('button[data-test-id="AddOpportunityModalButton"]')||n.querySelector('button[data-testid="OpportunityDetailsModalButton"]')||n.querySelector('button[data-testid="ViewDetailsButton"]')),i&&e.textContent){const c=e.textContent.split(" ")[0],f=c.split("-")[0],m=c.split("-")[1],d=B(f),u={button:i,date:o,startTime:d,endTime:B(m,d),timeStr:c};a.push(u)}}}),a},U=(o,{isTestMode:s})=>{const t=document.querySelector('div[role="presentation"]');return t?V(o,t,{isTestMode:s}):[]},k=(o,s,t)=>{var l;if((l=o.button)==null||l.click(),s){setTimeout(()=>D(t),2e3);return}setTimeout(()=>{j(/^yes, add shift$/i,()=>{let r=1;const n=setInterval(()=>{r>60&&(clearInterval(n),D(t)),x(/^done$/i,()=>{clearInterval(n),t(!0)}),x(/^ok$/i,()=>{clearInterval(n),t(!1)}),r++},100)})||setTimeout(()=>D(t),500)},0)},z=(o,s)=>{let t=0;const l=500,r=5e3/l,n=setInterval(()=>{if(t++,t>r)return console.log("Loading Wait Time Over"),clearInterval(n),s();let e=!1;const i=document.querySelector('div[role="presentation"]');if(!i)return s();const c=i.querySelectorAll(':scope > div[data-test-component="StencilReactCol"]');if(c.length===2){const f=c[1];if(V(o,f,{isTestMode:!0}).length>0)e=!0;else{const d=f.querySelector('div[role="listitem"]');if(d){const u=d.querySelector('div[data-test-component="StencilText"]');if(u){const g=u.textContent||"",p=/There are \d+ available shifts\./;e=!g.includes("There aren\u2019t any available shifts.")&&!p.test(g)}}}}else console.log("No Third Row found in Presentation"),e=!0;e&&(clearInterval(n),s())},l)},X=o=>{const s=/\b(\d+)\s+shifts?\s+available\b/,t=o.match(s);return t?+t[1]:(console.log("No shifts available information found."),NaN)},q=(o,s,t,l,a)=>{const r=o.split(" "),n=r[0]+" "+parseInt(r[1],10).toString(),e=document.querySelector('div[data-test-id="day-selector"]');if(!e){console.log("No day Selector");return}const i=e.querySelector('div[role="tablist"]');let c=!1;const f=`div[aria-label*="${n.replace(" ","  ")}"]`,m=e.querySelector(f);if(!m){console.log("Day Tab not found for ",n),s();return}const d=m.getAttribute("aria-label")||"",u=X(d);console.log(u,"Shifts Available",o),l&&i.scroll({left:m.offsetLeft-i.offsetLeft,behavior:"smooth"}),m&&(m.click(),u===0&&!a?setTimeout(s,10):(t&&setTimeout(()=>z(o,s),10),!t&&setTimeout(s,10)),c=!0,console.log("Selected Date: ",n)),c||console.log("Day Tab not found for ",n)},Y=(o=[])=>o.filter((s,t)=>o.indexOf(s)===t),Z=(o,s,t,l)=>{const{testMode:a}=l,r=a==="On";let n=U(s,{isTestMode:r}),e=K(n,"desc",d=>d>-1&&d<=0);console.log("Ready VETS",{vets:n}),console.log("Groups",e);let i=[],c=[];for(let d=0;d<o.length;d++){const u=o[d];if(!P(u.date,s))continue;const g=u.preferedDuration==="Max"?1:-1;let p=u.preferedDuration==="Max"?0:e.length-1;t:for(p;p>-1&&p<e.length;p+=g){const T=e[p],v=N([u],T);if(v){for(let h=0;h<c.length;h++){const b=c[h],y=b[0].startTime,G=b[b.length-1].endTime,A=T[0].startTime,w=T[T.length-1].endTime,I=y<A&&G<=A,C=A<y&&w<=y;if(!I&&!C)continue t}c.push(T);const S=T.map(h=>({vet:h,filter:v}));i.push(...S)}}}console.log("Acceptable VETS",{acceptables:i});let f=$(i,o);console.log("Acceptable Sorted As Filters VETS",{acceptablesSortedAsFilters:f});const m=()=>F(`${f.length} Acceptable VETs`);M.add(m),O(f,(d,u,g)=>{const p=d.vet,T=d.filter,v=()=>F(`Accepting VET...</br>(${g+1} of ${f.length})`);M.add(v),k(p,r,S=>{!r&&S&&R(L.vetFilters,T),u()})},t,"AcceptVETSLooper",200)},_=o=>{const s=o.map(e=>e.date.split(",")[0]),t=Y(s),a=new URLSearchParams(window.location.search).get("date");let r="",n=t[0];return a&&(r=W(a),t.includes(r)&&(t.splice(t.indexOf(r),1),t.unshift(r)),console.log("Pre Selected Date is",r)),{selectableDates:t,preSelectedDate:r,nextPreSelectedDate:n}},tt=o=>{console.log({preference:o}),o.refreshMode;const s=o.testMode==="On";chrome.storage.local.get(L.vetFilters,function(t){const l=t.vetFilters||[];console.log("vetFilters",l);const{selectableDates:a,preSelectedDate:r,nextPreSelectedDate:n}=_(l);O(a,(e,i,c)=>{q(e,()=>{Z(l,e,i,o)},!(e===r),!0,s)},()=>{n&&q(n,()=>{},!1,!0,s),E(l,o)},"SelectDayLooper",0,0)})};Q(tt);
