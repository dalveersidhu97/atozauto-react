import{S as B}from"./comparison.utils.08c82949.js";import{l as L,f as C,k as E,m as P,a as N,I as D,c as A,p as $,d as M,b as x,e as j}from"./content.utils.1be2cea8.js";import{d as R,c as F}from"./formatters.738ad4ac.js";import{s as W}from"./init.content.8bae4b55.js";const Q=(o,s="asc")=>o.sort((t,l)=>{const a=t[0].startTime,r=t[t.length-1].endTime,n=l[0].startTime,e=l[l.length-1].endTime;if(a!==n)return a-n;const i=r-a,c=e-n;return s==="asc"?i-c:c-i}),H=(o,s="asc")=>o.sort((t,l)=>{const a=t[0].startTime;let r=t[t.length-1].endTime;r<=a&&(r=r+24*60);const n=l[0].startTime;let e=l[l.length-1].endTime;e<=n&&(e=e+24*60);const i=r-a,c=e-n;return s==="asc"?i-c:c-i}),J=(o,s="asc",t)=>{const l=o.map(e=>[e]),a=Q(l,s),r=[];for(let e=0;e<a.length;e++){const i=[...a[e]];if(i[i.length-1].endTime>=24*60)break;let c=e+1,p=a.length-1;for(;p>0&&!(i[i.length-1].endTime>=24*60);){p--,c===a.length&&(c=0);const d=[...a[c]];let u=i[i.length-1].endTime,f=d[0].startTime;f>=24*60&&(f=f-24*60),u>=24*60&&(u=u-24*60);const m=f-u;t(m)&&i.push(...d),c++}i.length>1&&r.push(i)}return r.push(...l),H(r,s)},O=(o,s,{isTestMode:t})=>{if(!document.querySelector('div[role="presentation"]'))return[];const a=[];return s.querySelectorAll('div[role="listitem"]').forEach(n=>{const e=n.querySelector('div[role="heading"]');if(e){let i=n.querySelector('button[data-test-id="AddOpportunityModalButton"]');if(t&&(i=n.querySelector('button[data-test-id="AddOpportunityModalButton"]')||n.querySelector('button[data-testid="OpportunityDetailsModalButton"]')||n.querySelector('button[data-testid="ViewDetailsButton"]')),i&&e.textContent){const c=e.textContent.split(" ")[0],p=c.split("-")[0],d=c.split("-")[1],u=F(p),f={button:i,date:o,startTime:u,endTime:F(d,u),timeStr:c};a.push(f)}}}),a},K=(o,{isTestMode:s})=>{const t=document.querySelector('div[role="presentation"]');return t?O(o,t,{isTestMode:s}):[]},U=(o,s,t)=>{var l;if((l=o.button)==null||l.click(),s){setTimeout(()=>A(t),2e3);return}setTimeout(()=>{$(/^yes, add shift$/i,()=>{let r=1;const n=setInterval(()=>{r>60&&(clearInterval(n),A(t)),M(/^done$/i,()=>{clearInterval(n),t(!0)}),M(/^ok$/i,()=>{clearInterval(n),t(!1)}),r++},100)})||setTimeout(()=>A(t),500)},0)},k=(o,s)=>{let t=0;const l=500,r=5e3/l,n=setInterval(()=>{if(t++,t>r)return console.log("Loading Wait Time Over"),clearInterval(n),s();let e=!1;const i=document.querySelector('div[role="presentation"]');if(!i)return s();const c=i.querySelectorAll(':scope > div[data-test-component="StencilReactCol"]');if(c.length===2){const p=c[1];if(O(o,p,{isTestMode:!0}).length>0)e=!0;else{const u=p.querySelector('div[role="listitem"]');if(u){const f=u.querySelector('div[data-test-component="StencilText"]');if(f){const m=f.textContent||"",T=/There are \d+ available shifts\./;e=!m.includes("There aren\u2019t any available shifts.")&&!T.test(m)}}}}else console.log("No Third Row found in Presentation"),e=!0;e&&(clearInterval(n),s())},l)},z=o=>{const s=/\b(\d+)\s+shifts?\s+available\b/,t=o.match(s);return t?+t[1]:(console.log("No shifts available information found."),NaN)},q=(o,s,t,l,a)=>{const r=o.split(" "),n=r[0]+" "+parseInt(r[1],10).toString(),e=document.querySelector('div[data-test-id="day-selector"]');if(!e){console.log("No day Selector");return}const i=e.querySelector('div[role="tablist"]');let c=!1;const p=`div[aria-label*="${n.replace(" ","  ")}"]`,d=e.querySelector(p);if(!d){console.log("Day Tab not found for ",n),s();return}const u=d.getAttribute("aria-label")||"",f=z(u);console.log(f,"Shifts Available",o),l&&i.scroll({left:d.offsetLeft-i.offsetLeft,behavior:"smooth"}),d&&(d.click(),f===0&&!a?setTimeout(s,10):(t&&setTimeout(()=>k(o,s),10),!t&&setTimeout(s,10)),c=!0,console.log("Selected Date: ",n)),c||console.log("Day Tab not found for ",n)},X=(o=[])=>o.filter((s,t)=>o.indexOf(s)===t),Y=(o,s,t,l)=>{const{testMode:a}=l,r=a==="On";let n=K(s,{isTestMode:r});console.log("Ready VETS",{vets:n});let e=[],i=[];for(let d=0;d<o.length;d++){const u=o[d];let f=J(n,u.preferedDuration==="Max"?"desc":"asc",m=>m>-1&&m<=0);if(!E(u.date,s))continue;t:for(let m=0;m<f.length;m++){const T=f[m],h=P([u],T);if(h){for(let g=0;g<i.length;g++){const S=i[g],b=S[0].startTime,V=S[S.length-1].endTime,y=T[0].startTime,w=T[T.length-1].endTime,G=b<y&&V<=y,I=y<b&&w<=b;if(!G&&!I)continue t}i.push(T);const v=T.map(g=>({vet:g,filter:h}));e.push(...v)}}}console.log("Acceptable VETS",{acceptables:e});let c=N(e,o);console.log("Acceptable Sorted As Filters VETS",{acceptablesSortedAsFilters:c});const p=()=>x(`${c.length} Acceptable VETs`);D.add(p),L(c,(d,u,f)=>{const m=d.vet,T=d.filter,h=()=>x(`Accepting VET...</br>(${f+1} of ${c.length})`);D.add(h),U(m,r,v=>{!r&&v&&j(B.vetFilters,T),u()})},t,"AcceptVETSLooper",200)},Z=o=>{const s=o.map(e=>e.date.split(",")[0]),t=X(s),a=new URLSearchParams(window.location.search).get("date");let r="",n=t[0];return a&&(r=R(a),t.includes(r)&&(t.splice(t.indexOf(r),1),t.unshift(r)),console.log("Pre Selected Date is",r)),{selectableDates:t,preSelectedDate:r,nextPreSelectedDate:n}},_=o=>{console.log({preference:o}),o.refreshMode;const s=o.testMode==="On";chrome.storage.local.get(B.vetFilters,function(t){const l=t.vetFilters||[];console.log("vetFilters",l);const{selectableDates:a,preSelectedDate:r,nextPreSelectedDate:n}=Z(l);L(a,(e,i,c)=>{q(e,()=>{Y(l,e,i,o)},!(e===r),!0,s)},()=>{n&&q(n,()=>{},!1,!0,s),C(l,o)},"SelectDayLooper",0,0)})};W(_);
